<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>University Warehouse - Performance Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }
        .sidebar {
            background-color: #343a40;
            color: #fff;
            min-height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            padding-top: 20px;
        }
        .sidebar .nav-link {
            color: #ced4da;
            font-size: 16px;
            padding: 10px 20px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .sidebar .nav-link:hover {
            color: #fff;
            background-color: #495057;
        }
        .sidebar .nav-link.active {
            color: #fff;
            background-color: #0d6efd;
        }
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        .logo {
            text-align: center;
            padding: 15px 0 30px;
            margin-bottom: 20px;
            border-bottom: 1px solid #495057;
        }
        .logo h4 {
            color: #fff;
            margin: 0;
        }
        .user-info {
            text-align: center;
            padding: 15px;
            border-top: 1px solid #495057;
            margin-top: 20px;
        }
        .card {
            border: none;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .filter-row {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<!-- Sidebar -->
<div class="sidebar">
    <div class="logo">
        <h4>University Warehouse</h4>
        <small>Decision Support System</small>
    </div>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" th:href="@{/dashboard}">
                <i class="bi bi-speedometer2"></i> Dashboard
            </a>
        </li>
        <li class="nav-item" th:if="${isViceChancellor || isAdmin}">
            <a class="nav-link" th:href="@{/enrollment-report}">
                <i class="bi bi-people"></i> Enrollment
            </a>
        </li>
        <li class="nav-item" th:if="${isAcademicHead || isViceChancellor || isAdmin}">
            <a class="nav-link active" th:href="@{/performance-report}">
                <i class="bi bi-bar-chart"></i> Performance
            </a>
        </li>
        <li class="nav-item" th:if="${isAdmissionsDirector || isViceChancellor || isAdmin}">
            <a class="nav-link" th:href="@{/admissions-report}">
                <i class="bi bi-file-earmark-plus"></i> Admissions
            </a>
        </li>
        <li class="nav-item" th:if="${isFinanceDirector || isViceChancellor || isAdmin}">
            <a class="nav-link" th:href="@{/finance-report}">
                <i class="bi bi-cash-coin"></i> Finance
            </a>
        </li>
        <li class="nav-item" th:if="${isAdmin}">
            <a class="nav-link" th:href="@{/etl-management}">
                <i class="bi bi-gear"></i> ETL Management
            </a>
        </li>
    </ul>
    <div class="user-info">
        <p class="mb-1"><i class="bi bi-person-circle"></i> <span th:text="${username}">Username</span></p>
        <a th:href="@{/logout}" class="btn btn-sm btn-outline-light">
            <i class="bi bi-box-arrow-right"></i> Logout
        </a>
    </div>
</div>

<!-- Main Content -->
<div class="main-content">
    <div class="container">
        <h2 class="mb-4">Academic Performance Analysis</h2>

        <div class="row filter-row">
            <div class="col-md-3">
                <label for="yearFilter" class="form-label">Academic Year</label>
                <select class="form-select" id="yearFilter">
                    <option value="2023">2023</option>
                    <option value="2022">2022</option>
                    <option value="2021">2021</option>
                    <option value="2020">2020</option>
                    <option value="2019">2019</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="facultyFilter" class="form-label">Faculty</label>
                <select class="form-select" id="facultyFilter">
                    <option value="all">All Faculties</option>
                    <option value="1">Faculty of Science</option>
                    <option value="2">Faculty of Arts</option>
                    <option value="3">Faculty of Engineering</option>
                    <option value="4">Faculty of Business</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="departmentFilter" class="form-label">Department</label>
                <select class="form-select" id="departmentFilter">
                    <option value="all">All Departments</option>
                    <!-- Departments will be populated dynamically based on faculty selection -->
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button id="applyFilters" class="btn btn-primary w-100">Apply Filters</button>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card p-4">
                    <h4>Pass/Fail Rates by Module</h4>
                    <div class="chart-container">
                        <canvas id="passFailChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card p-4">
                    <h4>Grade Distribution</h4>
                    <div class="chart-container">
                        <canvas id="gradeDistributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="card p-4">
            <h4>Modules with Highest Failure Rates</h4>
            <div class="table-responsive">
                <table class="table table-striped" id="highFailureTable">
                    <thead>
                    <tr>
                        <th>Module ID</th>
                        <th>Module Name</th>
                        <th>Department</th>
                        <th>Total Students</th>
                        <th>Fail Count</th>
                        <th>Fail Rate</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Data will be populated via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card p-4">
            <h4>Performance Trend (5-Year)</h4>
            <div class="chart-container">
                <canvas id="performanceTrendChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize charts with sample data
        // In a real application, you would fetch this data from your API endpoints

        // Pass/Fail Rate Chart
        const passFailCtx = document.getElementById('passFailChart').getContext('2d');
        const passFailChart = new Chart(passFailCtx, {
            type: 'bar',
            data: {
                labels: ['Database Systems', 'Programming 101', 'Data Structures', 'Web Development', 'AI Principles'],
                datasets: [
                    {
                        label: 'Pass Rate (%)',
                        data: [85, 72, 65, 88, 78],
                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                    },
                    {
                        label: 'Fail Rate (%)',
                        data: [15, 28, 35, 12, 22],
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                    },
                    y: {
                        beginAtZero: true,
                        max: 100,
                        stacked: true
                    }
                }
            }
        });

        // Grade Distribution Chart
        const gradeDistCtx = document.getElementById('gradeDistributionChart').getContext('2d');
        const gradeDistChart = new Chart(gradeDistCtx, {
            type: 'pie',
            data: {
                labels: ['A', 'B', 'C', 'D', 'F'],
                datasets: [{
                    data: [22, 35, 25, 10, 8],
                    backgroundColor: [
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(255, 159, 64, 0.7)',
                        'rgba(255, 99, 132, 0.7)'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                }
            }
        });

        // Performance Trend Chart
        const trendCtx = document.getElementById('performanceTrendChart').getContext('2d');
        const trendChart = new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: ['2019', '2020', '2021', '2022', '2023'],
                datasets: [
                    {
                        label: 'Average GPA',
                        data: [3.2, 3.3, 3.1, 3.4, 3.5],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        fill: true
                    },
                    {
                        label: 'Pass Rate (%)',
                        data: [82, 84, 79, 86, 88],
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        tension: 0.1,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 2,
                        max: 4,
                        title: {
                            display: true,
                            text: 'Average GPA'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        beginAtZero: false,
                        min: 70,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Pass Rate (%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });

        // Populate highest failure rate table with sample data
        const highFailureTable = document.getElementById('highFailureTable').getElementsByTagName('tbody')[0];
        const sampleFailureData = [
            { id: 'CS101', name: 'Data Structures', department: 'Computer Science', students: 120, fails: 42, rate: '35.0%' },
            { id: 'MATH201', name: 'Advanced Calculus', department: 'Mathematics', students: 85, fails: 25, rate: '29.4%' },
            { id: 'PHYS102', name: 'Quantum Physics', department: 'Physics', students: 65, fails: 18, rate: '27.7%' },
            { id: 'CS305', name: 'Algorithm Design', department: 'Computer Science', students: 75, fails: 20, rate: '26.7%' },
            { id: 'ENG204', name: 'Mechanics', department: 'Engineering', students: 110, fails: 25, rate: '22.7%' },
        ];

        sampleFailureData.forEach(module => {
            const row = highFailureTable.insertRow();
            row.insertCell(0).textContent = module.id;
            row.insertCell(1).textContent = module.name;
            row.insertCell(2).textContent = module.department;
            row.insertCell(3).textContent = module.students;
            row.insertCell(4).textContent = module.fails;
            const failRateCell = row.insertCell(5);
            failRateCell.textContent = module.rate;
            failRateCell.classList.add('text-danger', 'fw-bold');
        });

        // Filter change listeners
        const facultyFilter = document.getElementById('facultyFilter');
        const departmentFilter = document.getElementById('departmentFilter');

        facultyFilter.addEventListener('change', function() {
            // In a real application, you would fetch departments based on the selected faculty
            const faculty = this.value;
            departmentFilter.innerHTML = '<option value="all">All Departments</option>';

            if (faculty === '1') { // Science
                addDepartmentOption('101', 'Computer Science');
                addDepartmentOption('102', 'Mathematics');
                addDepartmentOption('103', 'Physics');
                addDepartmentOption('104', 'Chemistry');
            } else if (faculty === '2') { // Arts
                addDepartmentOption('201', 'English');
                addDepartmentOption('202', 'History');
                addDepartmentOption('203', 'Philosophy');
            } else if (faculty === '3') { // Engineering
                addDepartmentOption('301', 'Mechanical Engineering');
                addDepartmentOption('302', 'Electrical Engineering');
                addDepartmentOption('303', 'Civil Engineering');
            } else if (faculty === '4') { // Business
                addDepartmentOption('401', 'Accounting');
                addDepartmentOption('402', 'Marketing');
                addDepartmentOption('403', 'Finance');
            }
        });

        function addDepartmentOption(value, text) {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = text;
            departmentFilter.appendChild(option);
        }

        // Apply filters button
        document.getElementById('applyFilters').addEventListener('click', function() {
            const year = document.getElementById('yearFilter').value;
            const faculty = facultyFilter.value;
            const department = departmentFilter.value;

            // Here you would make API calls to fetch data based on selected filters
            // For this demo, we'll just show an alert
            alert(`Filters applied: Year=${year}, Faculty=${faculty}, Department=${department}`);
        });
    });
</script>
</body>
</html>